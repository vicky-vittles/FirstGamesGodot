[gd_scene load_steps=15 format=2]

[ext_resource path="res://entities/human/ai/_Brain.tscn" type="PackedScene" id=1]
[ext_resource path="res://systems/behavior_tree/Composites/sequencer.gd" type="Script" id=2]
[ext_resource path="res://entities/human/ai/actions/move_to_target.gd" type="Script" id=3]
[ext_resource path="res://entities/human/ai/actions/set_target.gd" type="Script" id=4]
[ext_resource path="res://entities/human/ai/actions/calculate_path_to_target.gd" type="Script" id=6]
[ext_resource path="res://entities/human/ai/setters/set_move_direction.gd" type="Script" id=7]
[ext_resource path="res://entities/human/ai/conditions/is_in_state.gd" type="Script" id=8]
[ext_resource path="res://entities/human/ai/conditions/test_flag.gd" type="Script" id=9]
[ext_resource path="res://systems/behavior_tree/Decorators/succeeder.gd" type="Script" id=10]
[ext_resource path="res://systems/behavior_tree/Decorators/inverter.gd" type="Script" id=11]
[ext_resource path="res://entities/human/ai/setters/set_inputs.gd" type="Script" id=12]
[ext_resource path="res://entities/human/ai/actions/find_random_hiding_spot.gd" type="Script" id=13]
[ext_resource path="res://entities/human/ai/setters/set_flag.gd" type="Script" id=14]
[ext_resource path="res://entities/human/ai/conditions/check_if_has_been_found.gd" type="Script" id=15]

[node name="Brain" instance=ExtResource( 1 )]

[node name="root" type="Node" parent="." index="0"]
script = ExtResource( 2 )

[node name="update flags" type="Node" parent="root" index="0"]
script = ExtResource( 10 )

[node name="update is_hidden and has_hiding_spot" type="Node" parent="root/update flags" index="0"]
script = ExtResource( 2 )

[node name="if was hidden" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="0"]
script = ExtResource( 9 )
flag_name = "is_hidden"

[node name="and had hiding spot" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="1"]
script = ExtResource( 9 )
flag_name = "has_hiding_spot"

[node name="found_by_assassin test" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="2"]
script = ExtResource( 15 )
tests_to_make = [ "is_near", "is_directed_at" ]

[node name="and found_by_assassin" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="3"]
script = ExtResource( 9 )
flag_name = "found_by_assassin"

[node name="not hidden anymore" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="4"]
script = ExtResource( 14 )
flag_name = "is_hidden"

[node name="doesnt have a hiding spot anymore" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="5"]
script = ExtResource( 14 )
flag_name = "has_hiding_spot"

[node name="prepare to run" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot" index="6"]
script = ExtResource( 2 )

[node name="stop crouching" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot/prepare to run" index="0"]
script = ExtResource( 10 )

[node name="sequencer" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot/prepare to run/stop crouching" index="0"]
script = ExtResource( 2 )

[node name="check if in crouch state" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot/prepare to run/stop crouching/sequencer" index="0"]
script = ExtResource( 8 )
state = "Crouch"

[node name="press crouch" type="Node" parent="root/update flags/update is_hidden and has_hiding_spot/prepare to run/stop crouching/sequencer" index="1"]
script = ExtResource( 12 )
buttons_to_press = [ "crouch" ]
press_types = [ 2 ]
values = [ true ]

[node name="go to hiding spot" type="Node" parent="root" index="1"]
script = ExtResource( 2 )

[node name="update hiding spot" type="Node" parent="root/go to hiding spot" index="0"]
script = ExtResource( 10 )

[node name="find hiding spot" type="Node" parent="root/go to hiding spot/update hiding spot" index="0"]
script = ExtResource( 2 )

[node name="if not hidden" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot" index="0"]
script = ExtResource( 11 )

[node name="check if hidden" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot/if not hidden" index="0"]
script = ExtResource( 9 )
flag_name = "is_hidden"

[node name="if has no hiding spot" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot" index="1"]
script = ExtResource( 11 )

[node name="check if has hiding spot" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot/if has no hiding spot" index="0"]
script = ExtResource( 9 )
flag_name = "has_hiding_spot"

[node name="get path to a hiding spot" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot" index="2"]
script = ExtResource( 2 )

[node name="find random hiding spot" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot/get path to a hiding spot" index="0"]
script = ExtResource( 13 )

[node name="set target" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot/get path to a hiding spot" index="1"]
script = ExtResource( 4 )
param_name = "random_hiding_spot"

[node name="calculate path to target" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot/get path to a hiding spot" index="2"]
script = ExtResource( 6 )

[node name="now has hiding spot" type="Node" parent="root/go to hiding spot/update hiding spot/find hiding spot/get path to a hiding spot" index="3"]
script = ExtResource( 14 )
flag_name = "has_hiding_spot"
value = true

[node name="move to hiding spot" type="Node" parent="root/go to hiding spot" index="1"]
script = ExtResource( 3 )

[node name="crouch and stay invisible" type="Node" parent="root" index="2"]
script = ExtResource( 2 )

[node name="crouch" type="Node" parent="root/crouch and stay invisible" index="0"]
script = ExtResource( 10 )

[node name="sequencer" type="Node" parent="root/crouch and stay invisible/crouch" index="0"]
script = ExtResource( 2 )

[node name="if not crouching" type="Node" parent="root/crouch and stay invisible/crouch/sequencer" index="0"]
script = ExtResource( 11 )

[node name="check if in crouch state" type="Node" parent="root/crouch and stay invisible/crouch/sequencer/if not crouching" index="0"]
script = ExtResource( 8 )
state = "Crouch"

[node name="press crouch" type="Node" parent="root/crouch and stay invisible/crouch/sequencer" index="1"]
script = ExtResource( 12 )
buttons_to_press = [ "crouch" ]
press_types = [ 2 ]
values = [ true ]

[node name="stay still" type="Node" parent="root/crouch and stay invisible" index="1"]
script = ExtResource( 7 )

[node name="now is hidden" type="Node" parent="root/crouch and stay invisible" index="2"]
script = ExtResource( 14 )
flag_name = "is_hidden"
value = true
